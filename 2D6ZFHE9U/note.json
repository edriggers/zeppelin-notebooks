{
  "paragraphs": [
    {
      "title": "Tutorial Data Schema - TPC-H",
      "text": "%md\n<link rel=\"stylesheet\" href=\"https://doc.splicemachine.com/zeppelin/css/zepstyles.css\" />\n# The Life of a Query\n\nThis notebook walks you through using Splice Machine to create, populate, and query a sample database. We'll use the TPC-H benchmarking data as our sample dataset.\n\nTPC-H is a decision support benchmark. It consists of a suite of business-oriented ad hoc queries and concurrent data modifications. The queries and the data populating the database have been chosen to have broad industry-wide relevance. This benchmark illustrates decision support systems that examine large volumes of data, execute queries with a high degree of complexity, and give answers to critical business questions.\n\nWe demonstrate running and optimizing queries in Splice Machine, in these sections:\n\n<ul class=\"italic\">\n    <li>Creating our Database in Splice Machine</li>\n    <li>Examining a Query Execution Plan</li>\n    <li>Informing the Optimizer</li>\n    <li>Adding Indexes to the Database</li>\n    <li>A Glimpse at Splice Machine Benchmark Results</li>\n    <li>Running Queries</li>\n</ul>\n\n<p class=\"noteIcon\">The code paragraphs in this notebook use the <em>%splicemachine</em> interpreter, which is pre-configured to interact with Splice Machine using ANSI SQL.</p>\n",
      "user": "splice",
      "dateUpdated": "2018-07-27T16:41:45+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<link rel=\"stylesheet\" href=\"https://doc.splicemachine.com/zeppelin/css/zepstyles.css\" />\n<h1>The Life of a Query</h1>\n<p>This notebook walks you through using Splice Machine to create, populate, and query a sample database. We&rsquo;ll use the TPC-H benchmarking data as our sample dataset.</p>\n<p>TPC-H is a decision support benchmark. It consists of a suite of business-oriented ad hoc queries and concurrent data modifications. The queries and the data populating the database have been chosen to have broad industry-wide relevance. This benchmark illustrates decision support systems that examine large volumes of data, execute queries with a high degree of complexity, and give answers to critical business questions.</p>\n<p>We demonstrate running and optimizing queries in Splice Machine, in these sections:</p>\n<ul class=\"italic\">\n    <li>Creating our Database in Splice Machine</li>\n    <li>Examining a Query Execution Plan</li>\n    <li>Informing the Optimizer</li>\n    <li>Adding Indexes to the Database</li>\n    <li>A Glimpse at Splice Machine Benchmark Results</li>\n    <li>Running Queries</li>\n</ul>\n<p class=\"noteIcon\">The code paragraphs in this notebook use the <em>%splicemachine</em> interpreter, which is pre-configured to interact with Splice Machine using ANSI SQL.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200309_-833146173",
      "id": "20180113-213553_290656873",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-06-21T21:29:50+0000",
      "dateFinished": "2018-06-21T21:29:50+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "focus": true,
      "$$hashKey": "object:6955"
    },
    {
      "text": "%md\n## Creating our Database in Splice Machine\n\nNow we'll create our database in Splice Machine, in the following steps:\n\n<ol class=\"italic\">\n    <li>Create the Schema</li>\n    <li>Create the Tables</li>\n    <li>Import the Data</li>\n</ol>\n\nNow we'll create the TPC-H schema in Splice Machine, create our tables, import the TPC-H data and run queries against that data.",
      "user": "splice",
      "dateUpdated": "2018-05-22T00:52:11+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h2>Creating our Database in Splice Machine</h2>\n<p>Now we&rsquo;ll create our database in Splice Machine, in the following steps:</p>\n<ol class=\"italic\">\n    <li>Create the Schema</li>\n    <li>Create the Tables</li>\n    <li>Import the Data</li>\n</ol>\n<p>Now we&rsquo;ll create the TPC-H schema in Splice Machine, create our tables, import the TPC-H data and run queries against that data.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200310_-831991927",
      "id": "20180125-195425_1198649470",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-05-22T00:52:11+0000",
      "dateFinished": "2018-05-22T00:52:11+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6956"
    },
    {
      "text": "%splicemachine\nCREATE SCHEMA TPCH1;",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:21:00+0000",
      "config": {
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {},
        "enabled": true,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR"
      },
      "apps": [],
      "jobName": "paragraph_1520184200310_-831991927",
      "id": "20180115-053038_1611909604",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6957"
    },
    {
      "text": "%md\n#### Overview of the TPC-H Schema\n\nHere's a view of the TPC-H schema:\n\n<img class=\"fit3qtrwidth\" src=\"https://s3.amazonaws.com/splice-examples/images/tutorials/sample-data-tpch-schema.png\">\n\n### 2. Create the Tables\n\nWe'll now create the TPCH tables in our schema. In case we're working on a database in which we may have already imported TPCH data, we'll first conditionally drop the tables we want to create:",
      "user": "splice",
      "dateUpdated": "2018-06-21T15:54:12+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h4>Overview of the TPC-H Schema</h4>\n<p>Here&rsquo;s a view of the TPC-H schema:</p>\n<img class=\"fit3qtrwidth\" src=\"https://s3.amazonaws.com/splice-examples/images/tutorials/sample-data-tpch-schema.png\">\n<h3>2. Create the Tables</h3>\n<p>We&rsquo;ll now create the TPCH tables in our schema. In case we&rsquo;re working on a database in which we may have already imported TPCH data, we&rsquo;ll first conditionally drop the tables we want to create:</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200310_-831991927",
      "id": "20180125-201218_1888148548",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-06-21T15:54:12+0000",
      "dateFinished": "2018-06-21T15:54:12+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6958"
    },
    {
      "text": "%splicemachine\nDROP TABLE IF EXISTS TPCH1.LINEITEM;\nDROP TABLE IF EXISTS TPCH1.ORDERS;\nDROP TABLE IF EXISTS TPCH1.CUSTOMER;\nDROP TABLE IF EXISTS TPCH1.PARTSUPP;\nDROP TABLE IF EXISTS TPCH1.SUPPLIER;\nDROP TABLE IF EXISTS TPCH1.PART;\nDROP TABLE IF EXISTS TPCH1.REGION;\nDROP TABLE IF EXISTS TPCH1.NATION;",
      "user": "splice",
      "dateUpdated": "2018-07-04T17:53:05+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "editorHide": false,
        "results": {},
        "enabled": true,
        "tableHide": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200311_-832376675",
      "id": "20180115-013106_1425678081",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6959"
    },
    {
      "text": "%splicemachine\nCREATE TABLE TPCH1.LINEITEM (\n L_ORDERKEY BIGINT NOT NULL,\n L_PARTKEY INTEGER NOT NULL,\n L_SUPPKEY INTEGER NOT NULL, \n L_LINENUMBER INTEGER NOT NULL, \n L_QUANTITY DECIMAL(15,2),\n L_EXTENDEDPRICE DECIMAL(15,2),\n L_DISCOUNT DECIMAL(15,2),\n L_TAX DECIMAL(15,2),\n L_RETURNFLAG VARCHAR(1), \n L_LINESTATUS VARCHAR(1),\n L_SHIPDATE DATE,\n L_COMMITDATE DATE,\n L_RECEIPTDATE DATE,\n L_SHIPINSTRUCT VARCHAR(25),\n L_SHIPMODE VARCHAR(10),\n L_COMMENT VARCHAR(44),\n PRIMARY KEY(L_ORDERKEY,L_LINENUMBER)\n );\n \n CREATE TABLE TPCH1.ORDERS (\n O_ORDERKEY BIGINT NOT NULL PRIMARY KEY,\n O_CUSTKEY INTEGER,\n O_ORDERSTATUS VARCHAR(1),\n O_TOTALPRICE DECIMAL(15,2),\n O_ORDERDATE DATE,\n O_ORDERPRIORITY VARCHAR(15),\n O_CLERK VARCHAR(15),\n O_SHIPPRIORITY INTEGER ,\n O_COMMENT VARCHAR(79)\n );\n \n CREATE TABLE TPCH1.CUSTOMER (\n C_CUSTKEY INTEGER NOT NULL PRIMARY KEY,\n C_NAME VARCHAR(25),\n C_ADDRESS VARCHAR(40),\n C_NATIONKEY INTEGER NOT NULL,\n C_PHONE VARCHAR(15),\n C_ACCTBAL DECIMAL(15,2),\n C_MKTSEGMENT VARCHAR(10),\n C_COMMENT VARCHAR(117)\n );\n \n CREATE TABLE TPCH1.PARTSUPP (\n PS_PARTKEY INTEGER NOT NULL ,\n PS_SUPPKEY INTEGER NOT NULL , \n PS_AVAILQTY INTEGER,\n PS_SUPPLYCOST DECIMAL(15,2),\n PS_COMMENT VARCHAR(199),\n PRIMARY KEY(PS_PARTKEY,PS_SUPPKEY) \n );\n \n CREATE TABLE TPCH1.SUPPLIER (\n S_SUPPKEY INTEGER NOT NULL PRIMARY KEY,\n S_NAME VARCHAR(25) ,\n S_ADDRESS VARCHAR(40) ,\n S_NATIONKEY INTEGER ,\n S_PHONE VARCHAR(15) ,\n S_ACCTBAL DECIMAL(15,2),\n S_COMMENT VARCHAR(101)\n );\n \n CREATE TABLE TPCH1.PART (\n P_PARTKEY INTEGER NOT NULL PRIMARY KEY,\n P_NAME VARCHAR(55) ,\n P_MFGR VARCHAR(25) ,\n P_BRAND VARCHAR(10) ,\n P_TYPE VARCHAR(25) ,\n P_SIZE INTEGER ,\n P_CONTAINER VARCHAR(10) ,\n P_RETAILPRICE DECIMAL(15,2),\n P_COMMENT VARCHAR(23)\n );\n \n CREATE TABLE TPCH1.REGION (\n R_REGIONKEY INTEGER NOT NULL PRIMARY KEY,\n R_NAME VARCHAR(25),\n R_COMMENT VARCHAR(152)\n );\n \n CREATE TABLE TPCH1.NATION (\n N_NATIONKEY INTEGER NOT NULL,\n N_NAME VARCHAR(25),\n N_REGIONKEY INTEGER NOT NULL,\n N_COMMENT VARCHAR(152),\n PRIMARY KEY (N_NATIONKEY)\n );",
      "user": "splice",
      "dateUpdated": "2018-07-04T17:11:10+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "ERROR"
      },
      "apps": [],
      "jobName": "paragraph_1520184200311_-832376675",
      "id": "20180129-104639_365354120",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6960"
    },
    {
      "text": "%md\n### 3. Import the Data\n\nWe have pre-loaded flat files with the TPCH data into an S3 bucket to facilitate importing the data. All we need to do is run an `IMPORT` statement for each table.\n\n<p class=\"noteNote\">Importing this much data can take a few minutes; you'll see the result of each import displayed below the <code>IMPORT</code> statements as they complete.</p>\n",
      "user": "splice",
      "dateUpdated": "2018-07-04T18:13:14+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>3. Import the Data</h3>\n<p>We have pre-loaded flat files with the TPCH data into an S3 bucket to facilitate importing the data. All we need to do is run an <code>IMPORT</code> statement for each table.</p>\n<p class=\"noteNote\">Importing this much data can take a few minutes; you'll see the result of each import displayed below the <code>IMPORT</code> statements as they complete.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200311_-832376675",
      "id": "20180125-201815_611540808",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-07-04T18:13:14+0000",
      "dateFinished": "2018-07-04T18:13:16+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6961"
    },
    {
      "text": "%md\n",
      "user": "splice",
      "dateUpdated": "2018-04-03T19:54:50+0000",
      "config": {
        "colWidth": 12,
        "enabled": false,
        "results": {},
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorMode": "ace/mode/markdown",
        "editorHide": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1522785290634_-1870742208",
      "id": "20180403-195450_1901236835",
      "dateCreated": "2018-04-03T19:54:50+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6962"
    },
    {
      "title": "Import Data",
      "text": "%splicemachine\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'LINEITEM', null, 's3a://splice-benchmark-data/flat/TPCH/1/lineitem', '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'ORDERS',   null, 's3a://splice-benchmark-data/flat/TPCH/1/orders',   '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'CUSTOMER', null, 's3a://splice-benchmark-data/flat/TPCH/1/customer', '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'PARTSUPP', null, 's3a://splice-benchmark-data/flat/TPCH/1/partsupp', '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'SUPPLIER', null, 's3a://splice-benchmark-data/flat/TPCH/1/supplier', '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'PART',     null, 's3a://splice-benchmark-data/flat/TPCH/1/part',     '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'REGION',   null, 's3a://splice-benchmark-data/flat/TPCH/1/region',   '|', null, null, null, null, 0, '/tmp', true, null);\n\ncall SYSCS_UTIL.IMPORT_DATA ('TPCH1', 'NATION',   null, 's3a://splice-benchmark-data/flat/TPCH/1/nation',   '|', null, null, null, null, 0, '/tmp', true, null);\n",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:21:27+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "editorHide": false,
        "title": false,
        "results": {
          "0": {
            "graph": {
              "mode": "table",
              "height": 96.946,
              "optionOpen": false
            }
          },
          "1": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "2": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "3": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "4": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "5": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "6": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          },
          "7": {
            "graph": {
              "mode": "table",
              "height": 89.0057,
              "optionOpen": false
            }
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200311_-832376675",
      "id": "20180115-012619_1984460020",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6963"
    },
    {
      "title": "Order Priority Checking Query (Q4)",
      "text": "%md\n## Examining a Query Execution Plan\n\nIn the next few sections of this notebook, we'll examine execution plans for TPC-H Query 4, which is known as the <em>Order Priority Checking Query</em>. This query counts the number of orders ordered in a given quarter of a given year in which at least one lineitem was received by the customer later than its committed date; you can use it to determine how well the order priority system is working and gives an assessment of customer satisfaction.\n\nSplice Machine generates an execution plan prior to running your query. You can use the `explain` command to generate and display the execution plan without actually running the query; this can help you to determine optimizing strategies for your queries. \n<p class=\"noteIcon\">The <a href=\"https://doc.splicemachine.com/developers_tuning_explainplan_examples.html\" target=\"_blank\">Reading Explain Plans</a> topic in our documentation describes how to read explain plans.</p>\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h2>Examining a Query Execution Plan</h2>\n<p>In the next few sections of this notebook, we&rsquo;ll examine execution plans for TPC-H Query 4, which is known as the <em>Order Priority Checking Query</em>. This query counts the number of orders ordered in a given quarter of a given year in which at least one lineitem was received by the customer later than its committed date; you can use it to determine how well the order priority system is working and gives an assessment of customer satisfaction.</p>\n<p>Splice Machine generates an execution plan prior to running your query. You can use the <code>explain</code> command to generate and display the execution plan without actually running the query; this can help you to determine optimizing strategies for your queries.<br/><p class=\"noteIcon\">The <a href=\"https://doc.splicemachine.com/developers_tuning_explainplan_examples.html\" target=\"_blank\">Reading Explain Plans</a> topic in our documentation describes how to read explain plans.</p></p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200312_-834300420",
      "id": "20180122-173257_1568071437",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6964"
    },
    {
      "text": "%splicemachine\n-- QUERY 04\nexplain  select\n\to_orderpriority,\n\tcount(*) as order_count\nfrom\n\tTPCH1.orders\nwhere\n\to_orderdate >= date('1993-07-01')\n\tand o_orderdate < add_months('1993-07-01',3)\n\tand exists (\n\t\tselect\n\t\t\t*\n\t\tfrom\n\t\t\tTPCH1.lineitem\n\t\twhere\n\t\t\tl_orderkey = o_orderkey\n\t\t\tand l_commitdate < l_receiptdate\n\t)\ngroup by\n\to_orderpriority\norder by\n\to_orderpriority\n-- END OF QUERY",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:24:10+0000",
      "config": {
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {},
        "enabled": true,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200312_-834300420",
      "id": "20180201-123806_1712783827",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6965"
    },
    {
      "title": "Splice Machine Optimizer",
      "text": "%md\n## Optimizing Query Performance\n\nIn this section we'll look at optimizing the execution plan for TPCH Query 4. We'll:\n\n* Collect Statistics to Inform the Optimizer\n* Add Indexes to Further Optimize the Plan\n* Compare Execution Plans\n\nThe *Splice Machine Optimizer* is a cost-based optimizer that generates optimal execution plans for database queries. You use our `analyze` command to collect statistics from your database, which the optimizer uses when planning the execution of a query.\n\n<p class=\"noteIcon\">Cost-based optimizers are powerful features of modern databases that enable query plans to change as the data profiles change. Optimizers make use of count distinct, quantiles, and most frequent item counts as heuristics.</p>\n\nWhen creating a plan for a query, our optimizer performs a number of important and valuable actions, including:\n\n* It creates an access plan, which determine the best path for accessing the data the query will operate upon; for example, the access path might be to scan an entire table or to use an index.\n* When joining tables, the optimizer evaluates the best *join order* and the *join strategy* to use.\n* The optimizer unrolls subqueries to reduce processing time\n\nThese metrics are usually extremely expensive but if approximate results are acceptable, there is a class of specialized algorithms, called streaming algorithms, or *sketches*, that can produce results orders-of magnitude faster and with mathematically proven error bounds. Splice Machine leverages the [Yahoo Sketches Library](https://datasketches.github.io/docs/TheChallenge.html) for its statistics gathering. \n\n### Collect Statistics\nOur first optimization is to collect statistics to inform the optimizer about our database. We use our `analyze` command to collect statistics on a schema (or table). This process requires a couple minutes.\n",
      "user": "splice",
      "dateUpdated": "2018-05-21T22:03:42+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h2>Optimizing Query Performance</h2>\n<p>In this section we&rsquo;ll look at optimizing the execution plan for TPCH Query 4. We&rsquo;ll:</p>\n<ul>\n  <li>Collect Statistics to Inform the Optimizer</li>\n  <li>Add Indexes to Further Optimize the Plan</li>\n  <li>Compare Execution Plans</li>\n</ul>\n<p>The <em>Splice Machine Optimizer</em> is a cost-based optimizer that generates optimal execution plans for database queries. You use our <code>analyze</code> command to collect statistics from your database, which the optimizer uses when planning the execution of a query.</p>\n<p class=\"noteIcon\">Cost-based optimizers are powerful features of modern databases that enable query plans to change as the data profiles change. Optimizers make use of count distinct, quantiles, and most frequent item counts as heuristics.</p>\n<p>When creating a plan for a query, our optimizer performs a number of important and valuable actions, including:</p>\n<ul>\n  <li>It creates an access plan, which determine the best path for accessing the data the query will operate upon; for example, the access path might be to scan an entire table or to use an index.</li>\n  <li>When joining tables, the optimizer evaluates the best <em>join order</em> and the <em>join strategy</em> to use.</li>\n  <li>The optimizer unrolls subqueries to reduce processing time</li>\n</ul>\n<p>These metrics are usually extremely expensive but if approximate results are acceptable, there is a class of specialized algorithms, called streaming algorithms, or <em>sketches</em>, that can produce results orders-of magnitude faster and with mathematically proven error bounds. Splice Machine leverages the <a href=\"https://datasketches.github.io/docs/TheChallenge.html\">Yahoo Sketches Library</a> for its statistics gathering. </p>\n<h3>Collect Statistics</h3>\n<p>Our first optimization is to collect statistics to inform the optimizer about our database. We use our <code>analyze</code> command to collect statistics on a schema (or table). This process requires a couple minutes.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200312_-834300420",
      "id": "20180115-053838_672371514",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-05-21T22:03:42+0000",
      "dateFinished": "2018-05-21T22:03:42+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6966"
    },
    {
      "title": "Collect Statistics",
      "text": "%splicemachine\nanalyze schema TPCH1;\n",
      "user": "splice",
      "dateUpdated": "2018-07-25T20:06:57+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "title": false,
        "results": {
          "0": {
            "graph": {
              "mode": "table",
              "height": 300,
              "optionOpen": false
            },
            "helium": {}
          }
        },
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200312_-834300420",
      "id": "20180115-053719_1393443514",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6967"
    },
    {
      "text": "%md\n### Rerun the Explain Plan After Collecting Statistics\n\nNow let's re-run the `explain` plan for Query 4 and see how the optimizer changed the plan after gathering statistics.\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Rerun the Explain Plan After Collecting Statistics</h3>\n<p>Now let&rsquo;s re-run the <code>explain</code> plan for Query 4 and see how the optimizer changed the plan after gathering statistics.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200313_-834685169",
      "id": "20180201-160453_2099057216",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6968"
    },
    {
      "text": "%splicemachine\n-- QUERY 04\nexplain select\n\to_orderpriority,\n\tcount(*) as order_count\nfrom\n\tTPCH1.orders\nwhere\n\to_orderdate >= date('1993-07-01')\n\tand o_orderdate < add_months('1993-07-01',3)\n\tand exists (\n\t\tselect\n\t\t\t*\n\t\tfrom\n\t\t\tTPCH1.lineitem\n\t\twhere\n\t\t\tl_orderkey = o_orderkey\n\t\t\tand l_commitdate < l_receiptdate\n\t)\ngroup by\n\to_orderpriority\norder by\n\to_orderpriority\n-- END OF QUERY",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:26:11+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "editorHide": false,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200313_-834685169",
      "id": "20180115-071650_158099310",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6969"
    },
    {
      "text": "%md\n### Compare Execution Plans After Analyzing the Database\n\nNow let's compare the plans to see what changed. At a quick glance, you'll notice that a very large difference in the `totalCost` numbers for every operation in the plan:\n\n#### After Collecting Statistics\n```\nPlan\nCursor(n=13,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  ->  ScrollInsensitive(n=12,totalCost=16920.058,outputRows=5,outputHeapSize=127 B,partitions=41)\n    ->  OrderBy(n=11,totalCost=16919.956,outputRows=5,outputHeapSize=127 B,partitions=41)\n      ->  ProjectRestrict(n=10,totalCost=16517.046,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        ->  GroupBy(n=9,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          ->  ProjectRestrict(n=8,totalCost=3004,outputRows=435327,outputHeapSize=39.081 MB,partitions=41)\n            ->  MergeSortJoin(n=7,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              ->  TableScan[ORDERS(1616)](n=6,totalCost=3004,scannedRows=1500000,outputRows=435327,outputHeapSize=39.081 MB,partitions=41,preds=[(O_ORDERDATE[5:2] >= 1993-07-01),(O_ORDERDATE[5:2] < dataTypeServices: DATE )])\n              ->  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                ->  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  ->  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    ->  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] < L_RECEIPTDATE[0:3])])\n                      ->  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n```\n\n#### Before Collecting Statistics\n```\nPlan\nCursor(n=13,rows=36753750,updateMode=READ_ONLY (1),engine=Spark)\n  ->  ScrollInsensitive(n=12,totalCost=1576165.614,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n    ->  OrderBy(n=11,totalCost=838921.423,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n      ->  ProjectRestrict(n=10,totalCost=400696.835,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n        ->  GroupBy(n=9,totalCost=98186.501,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n          ->  ProjectRestrict(n=8,totalCost=75629,outputRows=11837789,outputHeapSize=139.022 MB,partitions=41)\n            ->  MergeSortJoin(n=7,totalCost=98186.501,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              ->  TableScan[ORDERS(1616)](n=6,totalCost=75629,scannedRows=37812500,outputRows=11837789,outputHeapSize=139.022 MB,partitions=41,preds=[(O_ORDERDATE[5:2] >= 1993-07-01),(O_ORDERDATE[5:2] < dataTypeServices: DATE )])\n              ->  ProjectRestrict(n=5,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41)\n                ->  Distinct(n=4,totalCost=6717.476,outputRows=45375000,outputHeapSize=129.819 MB,partitions=1)\n                  ->  ProjectRestrict(n=3,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41)\n                    ->  ProjectRestrict(n=2,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41,preds=[(L_COMMITDATE[0:2] < L_RECEIPTDATE[0:3])])\n                      ->  TableScan[LINEITEM(1600)](n=1,totalCost=275004,scannedRows=137500000,outputRows=137500000,outputHeapSize=129.819 MB,partitions=41)\n```\n",
      "user": "splice",
      "dateUpdated": "2018-05-21T22:10:43+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Compare Execution Plans After Analyzing the Database</h3>\n<p>Now let&rsquo;s compare the plans to see what changed. At a quick glance, you&rsquo;ll notice that a very large difference in the <code>totalCost</code> numbers for every operation in the plan:</p>\n<h4>After Collecting Statistics</h4>\n<pre><code>Plan\nCursor(n=13,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  -&gt;  ScrollInsensitive(n=12,totalCost=16920.058,outputRows=5,outputHeapSize=127 B,partitions=41)\n    -&gt;  OrderBy(n=11,totalCost=16919.956,outputRows=5,outputHeapSize=127 B,partitions=41)\n      -&gt;  ProjectRestrict(n=10,totalCost=16517.046,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        -&gt;  GroupBy(n=9,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          -&gt;  ProjectRestrict(n=8,totalCost=3004,outputRows=435327,outputHeapSize=39.081 MB,partitions=41)\n            -&gt;  MergeSortJoin(n=7,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              -&gt;  TableScan[ORDERS(1616)](n=6,totalCost=3004,scannedRows=1500000,outputRows=435327,outputHeapSize=39.081 MB,partitions=41,preds=[(O_ORDERDATE[5:2] &gt;= 1993-07-01),(O_ORDERDATE[5:2] &lt; dataTypeServices: DATE )])\n              -&gt;  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                -&gt;  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  -&gt;  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    -&gt;  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] &lt; L_RECEIPTDATE[0:3])])\n                      -&gt;  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n</code></pre>\n<h4>Before Collecting Statistics</h4>\n<pre><code>Plan\nCursor(n=13,rows=36753750,updateMode=READ_ONLY (1),engine=Spark)\n  -&gt;  ScrollInsensitive(n=12,totalCost=1576165.614,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n    -&gt;  OrderBy(n=11,totalCost=838921.423,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n      -&gt;  ProjectRestrict(n=10,totalCost=400696.835,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n        -&gt;  GroupBy(n=9,totalCost=98186.501,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41)\n          -&gt;  ProjectRestrict(n=8,totalCost=75629,outputRows=11837789,outputHeapSize=139.022 MB,partitions=41)\n            -&gt;  MergeSortJoin(n=7,totalCost=98186.501,outputRows=36753750,outputHeapSize=139.022 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              -&gt;  TableScan[ORDERS(1616)](n=6,totalCost=75629,scannedRows=37812500,outputRows=11837789,outputHeapSize=139.022 MB,partitions=41,preds=[(O_ORDERDATE[5:2] &gt;= 1993-07-01),(O_ORDERDATE[5:2] &lt; dataTypeServices: DATE )])\n              -&gt;  ProjectRestrict(n=5,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41)\n                -&gt;  Distinct(n=4,totalCost=6717.476,outputRows=45375000,outputHeapSize=129.819 MB,partitions=1)\n                  -&gt;  ProjectRestrict(n=3,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41)\n                    -&gt;  ProjectRestrict(n=2,totalCost=275416.5,outputRows=45375000,outputHeapSize=129.819 MB,partitions=41,preds=[(L_COMMITDATE[0:2] &lt; L_RECEIPTDATE[0:3])])\n                      -&gt;  TableScan[LINEITEM(1600)](n=1,totalCost=275004,scannedRows=137500000,outputRows=137500000,outputHeapSize=129.819 MB,partitions=41)\n</code></pre>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200313_-834685169",
      "id": "20180201-160712_2000693903",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "dateStarted": "2018-05-21T22:10:43+0000",
      "dateFinished": "2018-05-21T22:10:43+0000",
      "status": "FINISHED",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6970"
    },
    {
      "title": "Indexes",
      "text": "%md\n\n### Optimize by Adding Indexes\n\nSplice Machine tables have primary keys either implicit or explicitly defined. Data is stored in order of these keys.\n\n<div class=\"notePlain\" style=\"max-width:40%;\">The primary key is not optimal for all queries.</div>\n\nUnlike HBase and other key-value stores, Splice Machine can use *secondary indexes* to improve the performance of data manipulation statements. In addition, `UNIQUE` indexes provide a form of data integrity checking.\n\nJust as we did when creating new tables, we'll first drop the indexes we're going to create, in case they already exist.\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Optimize by Adding Indexes</h3>\n<p>Splice Machine tables have primary keys either implicit or explicitly defined. Data is stored in order of these keys.</p>\n<div class=\"notePlain\" style=\"max-width:40%;\">The primary key is not optimal for all queries.</div>\n<p>Unlike HBase and other key-value stores, Splice Machine can use <em>secondary indexes</em> to improve the performance of data manipulation statements. In addition, <code>UNIQUE</code> indexes provide a form of data integrity checking.</p>\n<p>Just as we did when creating new tables, we&rsquo;ll first drop the indexes we&rsquo;re going to create, in case they already exist.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200313_-834685169",
      "id": "20180115-055551_1473914744",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6971"
    },
    {
      "text": "%splicemachine\ndrop index TPCH1.O_CUST_IDX;\ndrop index TPCH1.O_DATE_PRI_KEY_IDX;\ndrop index TPCH1.L_SHIPDATE_IDX;\ndrop index TPCH1.L_PART_IDX;",
      "user": "splice",
      "dateUpdated": "2018-05-22T03:41:06+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200314_-833530922",
      "id": "20180115-074728_655442192",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6972"
    },
    {
      "title": "Create Indexes",
      "text": "%splicemachine\ncreate index TPCH1.O_CUST_IDX on TPCH1.ORDERS(\n O_CUSTKEY,\n O_ORDERKEY\n );\n \n create index TPCH1.O_DATE_PRI_KEY_IDX on TPCH1.ORDERS(\n O_ORDERDATE,\n O_ORDERPRIORITY,\n O_ORDERKEY\n );\n \n create index TPCH1.L_SHIPDATE_IDX on TPCH1.LINEITEM(\n L_SHIPDATE,\n L_PARTKEY,\n L_EXTENDEDPRICE,\n L_DISCOUNT\n );\n \n create index TPCH1.L_PART_IDX on TPCH1.LINEITEM(\n L_PARTKEY,\n L_ORDERKEY,\n L_SUPPKEY,\n L_SHIPDATE,\n L_EXTENDEDPRICE,\n L_DISCOUNT,\n L_QUANTITY,\n L_SHIPMODE,\n L_SHIPINSTRUCT\n );",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:26:23+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "title": false,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200314_-833530922",
      "id": "20180115-055326_1726784632",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6973"
    },
    {
      "text": "%md\n### Re-analze and Re-run the Explain Plan After Indexing\n\nNow that we've added indexes to our database, let's re-analyze the database and then re-run the `explain` plan for Query 4 one more time to see how indexing has affected our execution plan.\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Re-analze and Re-run the Explain Plan After Indexing</h3>\n<p>Now that we&rsquo;ve added indexes to our database, let&rsquo;s re-analyze the database and then re-run the <code>explain</code> plan for Query 4 one more time to see how indexing has affected our execution plan.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200314_-833530922",
      "id": "20180125-203451_1030911184",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6974"
    },
    {
      "text": "%splicemachine\nanalyze schema TPCH1;",
      "user": "splice",
      "dateUpdated": "2018-03-05T05:58:20+0000",
      "config": {
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {},
        "enabled": true,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200314_-833530922",
      "id": "20180115-075331_1211951910",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6975"
    },
    {
      "text": "%splicemachine\n-- QUERY 04\nexplain select\n\to_orderpriority,\n\tcount(*) as order_count\nfrom\n\tTPCH1.orders\nwhere\n\to_orderdate >= date('1993-07-01')\n\tand o_orderdate < add_months('1993-07-01',3)\n\tand exists (\n\t\tselect\n\t\t\t*\n\t\tfrom\n\t\t\tTPCH1.lineitem\n\t\twhere\n\t\t\tl_orderkey = o_orderkey\n\t\t\tand l_commitdate < l_receiptdate\n\t)\ngroup by\n\to_orderpriority\norder by\n\to_orderpriority\n-- END OF QUERY",
      "user": "splice",
      "dateUpdated": "2018-06-06T20:28:03+0000",
      "config": {
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        },
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "editorHide": false,
        "results": {},
        "enabled": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200315_-833915671",
      "id": "20180115-064548_1062136708",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6976"
    },
    {
      "title": "Plan Comparison After Indexes",
      "text": "%md\n### Compare Execution Plans\n\nWe can now compare how the query will execute with indexing in place versus without indexes. You'll again notice that, among other differences, the `totalCost` values are lower for most operations because the optimizer was able to take advantage of the indexes we added.\n\n#### Query Plan After Indexing\n```\nPlan\nCursor(n=14,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  ->  ScrollInsensitive(n=13,totalCost=15353.855,outputRows=5,outputHeapSize=127 B,partitions=41)\n    ->  OrderBy(n=12,totalCost=15353.753,outputRows=5,outputHeapSize=127 B,partitions=41)\n      ->  ProjectRestrict(n=11,totalCost=14988.138,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        ->  GroupBy(n=10,totalCost=2463.089,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          ->  ProjectRestrict(n=9,totalCost=6001884,outputRows=435332,outputHeapSize=39.081 MB,partitions=41)\n            ->  MergeSortJoin(n=8,totalCost=2463.089,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              ->  ProjectRestrict(n=7,totalCost=6001884,outputRows=435332,outputHeapSize=39.081 MB,partitions=41)\n                ->  IndexScan[O_DATE_PRI_KEY_IDX(1745)](n=6,totalCost=1547.029,scannedRows=1160172,outputRows=435332,outputHeapSize=39.081 MB,partitions=41,baseTable=ORDERS(1616),preds=[(O_ORDERDATE[5:1] < dataTypeServices: DATE ),(O_ORDERDATE[5:1] >= 1993-07-01)])\n              ->  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                ->  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  ->  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    ->  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] < L_RECEIPTDATE[0:3])])\n                      ->  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n```\n\n#### Query Plan Before Indexing\n```\nPlan\nCursor(n=13,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  ->  ScrollInsensitive(n=12,totalCost=16920.058,outputRows=5,outputHeapSize=127 B,partitions=41)\n    ->  OrderBy(n=11,totalCost=16919.956,outputRows=5,outputHeapSize=127 B,partitions=41)\n      ->  ProjectRestrict(n=10,totalCost=16517.046,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        ->  GroupBy(n=9,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          ->  ProjectRestrict(n=8,totalCost=3004,outputRows=435327,outputHeapSize=39.081 MB,partitions=41)\n            ->  MergeSortJoin(n=7,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              ->  TableScan[ORDERS(1616)](n=6,totalCost=3004,scannedRows=1500000,outputRows=435327,outputHeapSize=39.081 MB,partitions=41,preds=[(O_ORDERDATE[5:2] >= 1993-07-01),(O_ORDERDATE[5:2] < dataTypeServices: DATE )])\n              ->  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                ->  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  ->  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    ->  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] < L_RECEIPTDATE[0:3])])\n                      ->  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n```",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Compare Execution Plans</h3>\n<p>We can now compare how the query will execute with indexing in place versus without indexes. You&rsquo;ll again notice that, among other differences, the <code>totalCost</code> values are lower for most operations because the optimizer was able to take advantage of the indexes we added.</p>\n<h4>Query Plan After Indexing</h4>\n<pre><code>Plan\nCursor(n=14,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  -&gt;  ScrollInsensitive(n=13,totalCost=15353.855,outputRows=5,outputHeapSize=127 B,partitions=41)\n    -&gt;  OrderBy(n=12,totalCost=15353.753,outputRows=5,outputHeapSize=127 B,partitions=41)\n      -&gt;  ProjectRestrict(n=11,totalCost=14988.138,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        -&gt;  GroupBy(n=10,totalCost=2463.089,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          -&gt;  ProjectRestrict(n=9,totalCost=6001884,outputRows=435332,outputHeapSize=39.081 MB,partitions=41)\n            -&gt;  MergeSortJoin(n=8,totalCost=2463.089,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              -&gt;  ProjectRestrict(n=7,totalCost=6001884,outputRows=435332,outputHeapSize=39.081 MB,partitions=41)\n                -&gt;  IndexScan[O_DATE_PRI_KEY_IDX(1745)](n=6,totalCost=1547.029,scannedRows=1160172,outputRows=435332,outputHeapSize=39.081 MB,partitions=41,baseTable=ORDERS(1616),preds=[(O_ORDERDATE[5:1] &lt; dataTypeServices: DATE ),(O_ORDERDATE[5:1] &gt;= 1993-07-01)])\n              -&gt;  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                -&gt;  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  -&gt;  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    -&gt;  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] &lt; L_RECEIPTDATE[0:3])])\n                      -&gt;  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n</code></pre>\n<h4>Query Plan Before Indexing</h4>\n<pre><code>Plan\nCursor(n=13,rows=5,updateMode=READ_ONLY (1),engine=Spark)\n  -&gt;  ScrollInsensitive(n=12,totalCost=16920.058,outputRows=5,outputHeapSize=127 B,partitions=41)\n    -&gt;  OrderBy(n=11,totalCost=16919.956,outputRows=5,outputHeapSize=127 B,partitions=41)\n      -&gt;  ProjectRestrict(n=10,totalCost=16517.046,outputRows=1604125,outputHeapSize=127 B,partitions=41)\n        -&gt;  GroupBy(n=9,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41)\n          -&gt;  ProjectRestrict(n=8,totalCost=3004,outputRows=435327,outputHeapSize=39.081 MB,partitions=41)\n            -&gt;  MergeSortJoin(n=7,totalCost=3955.595,outputRows=1604125,outputHeapSize=39.081 MB,partitions=41,preds=[(ExistsFlatSubquery-0-1.L_ORDERKEY[7:1] = O_ORDERKEY[7:2])])\n              -&gt;  TableScan[ORDERS(1616)](n=6,totalCost=3004,scannedRows=1500000,outputRows=435327,outputHeapSize=39.081 MB,partitions=41,preds=[(O_ORDERDATE[5:2] &gt;= 1993-07-01),(O_ORDERDATE[5:2] &lt; dataTypeServices: DATE )])\n              -&gt;  ProjectRestrict(n=5,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                -&gt;  Distinct(n=4,totalCost=277.69,outputRows=1501009,outputHeapSize=23.619 MB,partitions=1)\n                  -&gt;  ProjectRestrict(n=3,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41)\n                    -&gt;  ProjectRestrict(n=2,totalCost=11385.304,outputRows=1980401,outputHeapSize=31.163 MB,partitions=41,preds=[(L_COMMITDATE[0:2] &lt; L_RECEIPTDATE[0:3])])\n                      -&gt;  TableScan[LINEITEM(1600)](n=1,totalCost=11286.284,scannedRows=6001215,outputRows=6001215,outputHeapSize=31.163 MB,partitions=41)\n</code></pre>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200315_-833915671",
      "id": "20180115-164324_663989920",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6977"
    },
    {
      "title": "Representative Micro-Benchmarks",
      "text": "%md\n## A Glimpse at Splice Machine Benchmark Results\n\nHere are some micro-results from Splice Machine running TPC-H benchmarks:\n\n- 2ms single record lookups on primary keys at petabyte scale\n- 20ms single record updates at petabyte scale\n- 40-way OLTP indexed joins return in <100ms\n- 150-way OLAP style joins execute in under 2 minutes\n- 440-way join executes where others can\u2019t parse\n- Ingestion at 80MB/sec/node\n- Can run TPC-C and TPC-H simultaneously\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "title": false,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h2>A Glimpse at Splice Machine Benchmark Results</h2>\n<p>Here are some micro-results from Splice Machine running TPC-H benchmarks:</p>\n<ul>\n  <li>2ms single record lookups on primary keys at petabyte scale</li>\n  <li>20ms single record updates at petabyte scale</li>\n  <li>40-way OLTP indexed joins return in &lt;100ms</li>\n  <li>150-way OLAP style joins execute in under 2 minutes</li>\n  <li>440-way join executes where others can\u2019t parse</li>\n  <li>Ingestion at 80MB/sec/node</li>\n  <li>Can run TPC-C and TPC-H simultaneously</li>\n</ul>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200316_-835839416",
      "id": "20180118-022657_414327443",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6978"
    },
    {
      "text": "%md\n### Running TPC-H Queries\n\nNow we'll run TPC-H Query 02, so you can see the database in action.",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h3>Running TPC-H Queries</h3>\n<p>Now we&rsquo;ll run TPC-H Query 02, so you can see the database in action.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200316_-835839416",
      "id": "20180125-204204_1935879463",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6979"
    },
    {
      "text": "%splicemachine\n-- QUERY 02\nselect\n\ts_acctbal,\n\ts_name,\n\tn_name,\n\tp_partkey,\n\tp_mfgr,\n\ts_address,\n\ts_phone,\n\ts_comment\nfrom\n\tTPCH1.part,\n\tTPCH1.supplier,\n\tTPCH1.partsupp,\n\tTPCH1.nation,\n\tTPCH1.region\nwhere\n\tp_partkey = ps_partkey\n\tand s_suppkey = ps_suppkey\n\tand p_size = 15\n\tand p_type like '%BRASS'\n\tand s_nationkey = n_nationkey\n\tand n_regionkey = r_regionkey\n\tand r_name = 'EUROPE'\n\tand ps_supplycost = (\n\t\tselect\n\t\t\tmin(ps_supplycost)\n\t\tfrom\n\t\t\tTPCH1.partsupp,\n\t\t\tTPCH1.supplier,\n\t\t\tTPCH1.nation,\n\t\t\tTPCH1.region\n\t\twhere\n\t\t\tp_partkey = ps_partkey\n\t\t\tand s_suppkey = ps_suppkey\n\t\t\tand s_nationkey = n_nationkey\n\t\t\tand n_regionkey = r_regionkey\n\t\t\tand r_name = 'EUROPE'\n\t)\norder by\n\ts_acctbal desc,\n\tn_name,\n\ts_name,\n\tp_partkey\n{limit 100}\n-- END OF QUERY\n",
      "user": "splice",
      "dateUpdated": "2018-07-27T16:47:48+0000",
      "config": {
        "colWidth": 12,
        "editorMode": "ace/mode/sql",
        "results": {
          "0": {
            "graph": {
              "mode": "table",
              "height": 300,
              "optionOpen": false
            },
            "helium": {}
          }
        },
        "enabled": true,
        "editorSetting": {
          "language": "sql",
          "editOnDblClick": false
        }
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS"
      },
      "apps": [],
      "jobName": "paragraph_1520184200316_-835839416",
      "id": "20180115-083845_542565773",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "READY",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6980"
    },
    {
      "text": "%md\n## Where to Go Next\n\nThe next notebook in this presentation introduces you to the <a href=\"/#/notebook/2D93Y56QJ\">Splice Machine Database Console,</a> which you can use to monitor and control your currently running queries.",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "tableHide": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "editorHide": true,
        "results": {},
        "enabled": false
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "results": {
        "code": "SUCCESS",
        "msg": [
          {
            "type": "HTML",
            "data": "<div class=\"markdown-body\">\n<h2>Where to Go Next</h2>\n<p>The next notebook in this presentation introduces you to the <a href=\"/#/notebook/2D93Y56QJ\">Splice Machine Database Console,</a> which you can use to monitor and control your currently running queries.</p>\n</div>"
          }
        ]
      },
      "apps": [],
      "jobName": "paragraph_1520184200317_-836224164",
      "id": "20180122-173624_509126525",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6981"
    },
    {
      "text": "%md\n",
      "dateUpdated": "2018-03-04T17:23:20+0000",
      "config": {
        "colWidth": 12,
        "editorMode": "ace/mode/markdown",
        "results": {},
        "enabled": false,
        "editorSetting": {
          "language": "markdown",
          "editOnDblClick": true
        },
        "editorHide": true
      },
      "settings": {
        "params": {},
        "forms": {}
      },
      "apps": [],
      "jobName": "paragraph_1520184200317_-836224164",
      "id": "20180125-142959_1101825868",
      "dateCreated": "2018-03-04T17:23:20+0000",
      "status": "FINISHED",
      "errorMessage": "",
      "progressUpdateIntervalMs": 500,
      "$$hashKey": "object:6982"
    }
  ],
  "name": "3. Splice Deep Dive / 2. The Life of a Query",
  "id": "2D6ZFHE9U",
  "angularObjects": {
    "2DKZDNHV8:shared_process": [],
    "2DJTPJBES:shared_process": [],
    "2DM13S4RB:shared_process": [],
    "2DNKHFPM9:shared_process": [],
    "2DK21JBKV:shared_process": [],
    "2DM8PBKA1:shared_process": []
  },
  "config": {
    "looknfeel": "default",
    "personalizedMode": "false"
  },
  "info": {}
}